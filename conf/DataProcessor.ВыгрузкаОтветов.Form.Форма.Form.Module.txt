
&НаСервере
Процедура КомандаВыгрузитьНаСервере()
	РегистрыСведений.ХранилищеНастроек.ЗаписатьНастройку("ПутьКФайлу", ПутьКФайлу) ;
	Запись = Новый ЗаписьXML;
	Запись.ОткрытьФайл(ПутьКФайлу, "UTF-8");
	Запись.ЗаписатьОбъявлениеXML();
	ВыборкаРазделы = Справочники.Разделы.Выбрать();
	Запись.ЗаписатьНачалоЭлемента("OBJECTS");
	Пока ВыборкаРазделы.Следующий() Цикл
		ЗаписатьXML(Запись, ВыборкаРазделы.Ссылка.ПолучитьОбъект());
	КонецЦикла;
	
	ВыборкаВопросы = Справочники.ВопросыИОтветы.Выбрать();
	Пока ВыборкаВопросы.Следующий() Цикл
		ЗаписатьXML(Запись, ВыборкаВопросы.Ссылка.ПолучитьОбъект());
	КонецЦикла;
	
	Запись.ЗаписатьКонецЭлемента();//OBJECTS
	Запись.Закрыть();
	Сообщить("Выгружено! Файл "+ПутьКФайлу);
КонецПроцедуры

&НаКлиенте
Процедура КомандаВыгрузить(Команда)
	КомандаВыгрузитьНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ПутьКФайлу = РегистрыСведений.ХранилищеНастроек.ПолучитьНастройку("ПутьКФайлу", "")
КонецПроцедуры

&НаКлиенте
Процедура ПутьКФайлуНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
		// Создать новый диалог для открытия файлов.
	ДиалогФыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);

	ДиалогФыбораФайла.МножественныйВыбор=Ложь;

	// Какие типы файлов будут предложены для выбора.
	ДиалогФыбораФайла.Фильтр = "Файл с вопросами (*.xml)|*.xml|Все файлы |*.*";

	ДиалогФыбораФайла.Заголовок = "Выберите файл";                                         

	// В диалоге будет открыт предварительный просмотр файлов
	//ДиалогФыбораФайла.ПредварительныйПросмотр = Истина;

	// При открытии диалога сначала для выбора будут предложены файлы
	// первого типа, из типов, перечисленных в свойстве "Фильтр".
	ДиалогФыбораФайла.ИндексФильтра = 0;

	// Открыть диалог выбора файла.
	Если ДиалогФыбораФайла.Выбрать() Тогда

		ПутьКФайлу = ДиалогФыбораФайла.ВыбранныеФайлы[0];
		
		// Действия, выполняемые тогда, когда файл выбран.

	КонецЕсли;

КонецПроцедуры
