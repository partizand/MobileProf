&НаСервере
Процедура ВыполнитьПослеЗакрытияВопроса(ВыбранныеФайлы, Параметры) Экспорт
	
	Если ВыбранныеФайлы = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ТекОбъект = Объект.Ссылка.ПолучитьОбъект();
	
	//ТекОбъект = РеквизитФормыВЗначение("Объект");
	
	ТекОбъект.ХранилищеКартинки = Новый ХранилищеЗначения(Новый ДвоичныеДанные(ВыбранныеФайлы[0]));
	
	ТекОбъект.Записать();
	
	ЗначениеВРеквизитФормы(ТекОбъект, "Объект");
   
	//Модифицированность = Истина;
   
	ОбновитьКартинкуНаСервере();
КонецПроцедуры

&НаСервере
Процедура ДобавитьКартинкуНаСервере()
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКартинку(Команда)

	#Если НЕ МобильноеПриложениеКлиент Тогда
		
		Если ЭтаФорма.Модифицированность Тогда
			Предупреждение("Для добавления картинки необходимо записать объект!");
			Возврат;
		КонецЕсли;
		
		Фильтр       = "Любой файл (*.*)|*.*";
		
		Режим        = РежимДиалогаВыбораФайла.Открытие;
		ДиалогВыбора = Новый ДиалогВыбораФайла(Режим);
		
		ДиалогВыбора.Фильтр		 = Фильтр;
		ДиалогВыбора.Заголовок	 = "Выберите файл";
		ДиалогВыбора.ПроверятьСуществованиеФайла = Истина;
		
		ДиалогВыбора.Показать(Новый ОписаниеОповещения("ВыполнитьПослеЗакрытияВопроса", ЭтаФорма));
		
	#Иначе
	
		Предупреждение("Не доступно на мобильном клиенте!");
	#КонецЕсли
КонецПроцедуры

&НаСервере
Процедура УдалитьКартинкуНаСервере()
	ТекОбъект = РеквизитФормыВЗначение("Объект");
	ТекОбъект.ХранилищеКартинки = Новый ХранилищеЗначения(Неопределено);
	ТекОбъект.Записать();
	ЗначениеВРеквизитФормы(ТекОбъект, "Объект");

	//Модифицированность = Истина;
	 
	ОбновитьКартинкуНаСервере(); 
КонецПроцедуры

&НаКлиенте
Процедура УдалитьКартинкуОкончание(Рез, ДопПараметры) Экспорт
	Если Рез = КодВозвратаДиалога.Да Тогда
		УдалитьКартинкуНаСервере();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура УдалитьКартинку(Команда)
	#Если НЕ МобильноеПриложениеКлиент Тогда
		ПоказатьВопрос(Новый ОписаниеОповещения("УдалитьКартинкуОкончание", ЭтаФорма), "Удалить картинку?", РежимДиалогаВопрос.ДаНет);
	
	#Иначе
	
		Предупреждение("Не доступно на мобильном клиенте!");
	#КонецЕсли
	
КонецПроцедуры


&НаСервере
Процедура ОбновитьКартинкуНаСервере()
	РеквизитКартинка = ПоместитьВоВременноеХранилище(РеквизитФормыВЗначение("Объект").ХранилищеКартинки.Получить());
КонецПроцедуры

//&НаКлиенте
//Процедура ОбновитьКартинку()
//	Элементы.Декорация1.Картинка = ОбновитьКартинкуНаСервере();
//КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Сие чудо вставлено для совместимости с новыми версиями моб.платформы, т.к. например в версии 8.3.9.74 1с падает с ошибкой
	#Если МобильноеПриложениеСервер Тогда
		СисИнфо = Новый СистемнаяИнформация;
		Если СисИнфо.ВерсияПриложения <> "8.3.8.58" Тогда
			Элементы.ОтветыОтвет.МногострочныйРежим = Ложь;
		КонецЕсли;
	#КонецЕсли

КонецПроцедуры


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ОбновитьКартинкуНаСервере();
КонецПроцедуры


&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Объект.Наименование = Объект.Вопрос;
КонецПроцедуры

